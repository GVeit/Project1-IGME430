<!DOCTYPE html>
<html lang="en-us">
    <head>
        
    <title>Online Chat</title>
        
        <link rel="stylesheet" type="text/css" href="/style.css"/>
        
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
        
        <style>


        </style>
        
		<script type="text/javascript" >
        
			// Create a new Web Socket connection to the server
			//const ws = new WebSocket("ws://localhost:3000");// <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
            //const ws = new WebSocket("ws://veit-project1.herokuapp.com/");
            
            
            
            var HOST = location.origin.replace(/^http/, 'ws')
            var ws = new WebSocket(HOST);
            var el = document.getElementById('server-time');

            ws.onmessage = function (event) {
              el.innerHTML = 'Server time: ' + event.data;
            };
            
            
			// Emit a message event
			// Send a message to the server.
			function sendMessage() {

                const username = document.getElementById("nameField").value;
				//ws.send(username)
                
				const message = document.getElementById("message").value;
				//ws.send(message);
                
                var d = new Date();
                
                d = d.toLocaleString();
                console.log(d);

                const usersMessage = username + " - " + d + ": " + message;
                ws.send(usersMessage);
                
                document.getElementById("message").value = "";
			}

			// On Message events
			// Listen for message events from the server
			ws.addEventListener("message", function(event) {
                
                // Extract the message text from the data sent from the server.
				//const usernameData = event.data;
				// Extract the message text from the data sent from the server.
				const messageData = event.data;

				// Create the HTML element for displaying the message text on the page.
				const createMessage = document.createElement("li");
                //createMessage.appendChild(document.createTextNode(usernameData));
                
                //const createList = document.createElement("LI");
                //const createList = document.createElement("li");
                
				createMessage.appendChild(document.createTextNode(messageData));
				document.getElementById("chatlog").appendChild(createMessage)
			});
            
            
            /*
            //function to send our post request
            //function to send our post reques
            const sendPost = (e, nameForm) => {
              //grab the forms action (url to go to)
              //and method (HTTP method - POST in this case)
              const nameAction = nameForm.getAttribute('action');
              const nameMethod = nameForm.getAttribute('method');

              //grab the form's name and age fields so we can check user input
              const nameField = nameForm.querySelector('#nameField');

              //create a new Ajax request (remember this is asynchronous)
              const xhr = new XMLHttpRequest();
              //set the method (POST) and url (action field from form)
              xhr.open(nameMethod, nameAction);

              //set our request type to x-www-form-urlencoded
              //which is one of the common types of form data. 
              //This type has the same format as query strings key=value&key2=value2
              xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
              //set our requested response type in hopes of a JSON response
              xhr.setRequestHeader ('Accept', 'text/xml');

              //set our function to handle the response
              xhr.onload = () => handleResponse(xhr);

              //build our x-www-form-urlencoded format. Without ajax the 
              //browser would do this automatically but it forcefully changes pages
              //which we don't want.
              //The format is the same as query strings, so key=value&key2=value2
              //The 'name' fields from the inputs are the variable names sent to
              //the server. 
              //So ours might look like  name=test&age=22
              //Again the 'name' fields in the form are the variable names in the string
              //and the variable names the server will look for.
              const formData = `name=${nameField.value}&age=${ageField.value}`;

              //send our request with the data
              xhr.send(formData);

              //prevent the browser's default action (to send the form on its own)
              e.preventDefault();
              //return false to prevent the browser from trying to change page
              return false;
            };

            const init = () => {
                //grab form
                const nameForm = document.querySelector('#nameForm');

                const request = (e) => {
                    const urlField = document.querySelector('#urlField').value;
                    const methodSelect = document.querySelector('#methodSelect').value;
                    console.log(urlField);
                    //sendAjax(e, userForm, methodSelect);
                    sendAjax(e, urlField, methodSelect);
                }

                //create handler
                const addUser = (e) => {
                    sendPost(e, nameForm);
                }
                  //attach submit event (for clicking submit or hitting enter)
                  nameForm.addEventListener('submit', addUser);
            };

            window.onload = init;

            */
		</script>
        
    </head>
    <body>
        <div id="background">
            
            <div class="grid-container">

                <div class="Main">

                    <div class="box-grid-container">

                        <div class="box-chatBox">

                            <ul id="chatlog">
                            </ul>

                        </div>


                        <div class="box-messageBox">

                            <form>
                                <textarea id="message" name="message" style='width:100%;height:200px;margin-top: 0;resize: none;border-radius: 0.5rem; background-color: #161618; color:white;border:none;padding: 10px;' >
                                </textarea>
                            </form>
                            
                            <div id="userWrapper">
                                    
                                <span>Username: </span>
                                <input type="username" id="nameField" name="name" style="margin-top: 10px;width: 200px;border-radius: 12px;border: none;padding: 5px;"/> 
                                <input type="button" id="send" name="send" value="Send" onclick="sendMessage();" />
                                    
                            </div>

                        </div>

                    </div>

                </div>
                
                <div class="Header">
                    <<img src="eclipseLogo.png" alt="eclispe" width="300">
                </div>


                <div class="SideMenu">

                </div>

            </div>
            
        </div>
        
    </body>
</html>
